{"version":3,"sources":["components/SubscriptionItem.js","components/SubscribersList.js","components/UnsubscribeAll.js","App.js","index.js"],"names":["connect","state","source","isSubscriptionPage","unsubscribe_color","unsubscribeColor","subscribe_color","subscribeColor","searchObject","hashObject","props","console","log","item","dispatch","toggleSubscribe","a","fd","FormData","append","vk_user_id","vk_group_id","id","String","tag_id","JSON","stringify","fetch","params","method","isSubscribed","Object","entries","map","join","body","res","json","status","data","Error","text","i","count","type","payload","className","name","data-source","style","backgroundColor","onClick","subscriptions","subscription","key","subscribesCount","unsubscribeAll","alert","toString","textAlign","getObjectFromURL","url","slice","split","reduce","acc","value","window","location","hash","search","user_vk_id","loadSubscriptions","group_id","then","response","filter","length","bridge","subscribe","event","loading","popout","useEffect","size","activePanel","send","initialState","showUnsubscribeAll","store","createStore","action","sub","applyMiddleware","thunk","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.6e109514.chunk.js","sourcesContent":["import React, { useState } from 'react';\nimport { connect } from 'react-redux';\n\n\nconst buildQuery = (params) => {\n    return Object.entries(params).map((item) => item.join('=')).join('&');\n}\n\nconst SubscriptionItem = (props) => {\n\n    console.log('from sub item');\n\n    const {\n        item,\n        dispatch,\n        source,\n        isSubscriptionPage,\n        unsubscribe_color: unsubscribeColor,\n        subscribe_color: subscribeColor,\n    } = props;\n\n    const toggleSubscribe = async (item) => {\n        var fd = new FormData();\n\n        fd.append('user_vk_id', props.searchObject.vk_user_id);\n        fd.append('group_id', props.searchObject.vk_group_id);\n        fd.append('subscribe_id', item.id);\n        fd.append('source', String(source));\n        fd.append('tag_id', props.tag_id);\n\n        fd.append('utm_source', props.hashObject['utm_source'] || '');\n        fd.append('utm_medium', props.hashObject['utm_medium'] || '');\n        fd.append('utm_campaign', props.hashObject['utm_campaign'] || '');\n        fd.append('utm_content', props.hashObject['utm_content'] || '');\n        fd.append('utm_term', props.hashObject['utm_term'] || '');\n        fd.append('params', JSON.stringify(props.searchObject));\n\n        const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({ method: item.isSubscribed ? 'vkapp.unsubscribe_user' : 'vkapp.subscribe_user', }),\n            { method: 'POST', body: fd });\n\n        const { status, ...data } = await res.json();\n\n        if (status !== 'ok') {\n            throw new Error(data.text || 'Что-то пошло не так. Не удалось подписаться');\n        }\n\n        const i = { ...item };\n\n        i.isSubscribed = !item.isSubscribed;\n        i.count = item.isSubscribed ? item.count + -1 : (item.count + 1);\n        \n        dispatch({ type: 'TOGGLE_SUBSCRIBE', payload: { type: !item.isSubscribed ? 'subscribe' : 'unsubscribe', id: item.id } });\n    };\n\n    return (\n        <div className={`subscriptions-group-item ${isSubscriptionPage && 'subscription-page'}`}>\n            <div className=\"subscriptions-group-item__info\">\n                <p className=\"subscriptions-group-item__title\">{item.name}</p>\n                <p className=\"subscriptions-group-item__count\">Подписчиков: {item.count}</p>\n                <p>{item.id}</p>\n            </div>\n            <div className=\"subscriptions-group-item__action-block\">\n\n                {item.isSubscribed\n                    ? <button data-source={source}\n                        style={{ backgroundColor: unsubscribeColor ? unsubscribeColor : '' }}\n                        onClick={() => toggleSubscribe(item)}\n                        className=\"subscriptions-group-button unsubscribe-button\">Отписаться</button>\n                    : <button data-source={source}\n                        style={{ backgroundColor: subscribeColor ? subscribeColor : '' }}\n                        onClick={() => toggleSubscribe(item)}\n                        className=\"subscriptions-group-button subscribe-button\">Подписаться</button>\n                }\n\n            </div>\n        </div>\n    );\n};\n\nexport default connect(state => ({\n    source: state.source,\n    isSubscriptionPage: state.isSubscriptionPage,\n    unsubscribe_color: state.unsubscribeColor,\n    subscribe_color: state.subscribeColor,\n    searchObject: state.searchObject,\n    hashObject: state.hashObject,\n}))(SubscriptionItem);","import React, { useState, useEffect } from 'react';\nimport SubscriptionItem from './SubscriptionItem';\nimport { connect } from 'react-redux'\n\nconst SubscriptionsList = ({ subscriptions, source, unsubscribe_color }) => {\n    // const SubscriptionsList = (props) => {    \n\n    console.log('from sub list');\n\n    return (\n        <div className=\"subscription-group-lists\">\n            {subscriptions.map(subscription => (\n                <SubscriptionItem key={subscription.id} source={source} item={subscription} />\n            ))}\n        </div>\n    );\n};\n\n// export default connect(state => ({ ...state }))(SubscriptionsList);\nexport default connect(state => ({ subscriptions: state.subscriptions, unsubscribe_color: state.unsubscribe_color }))(SubscriptionsList);","import React, { useState, useEffect } from 'react';\nimport { connect } from 'react-redux';\n\nconst buildQuery = (params) => {\n    return Object.entries(params).map((item) => item.join('=')).join('&');\n}\n\nconst UnsubscribeAll = (props) => {\n\n\n    if (props.subscribesCount < 1) {\n        return '';\n    }\n\n    console.log('from unsub all');\n\n    const unsubscribeAll = async () => {\n        try {\n\n            const fd = new FormData();\n\n            fd.append('user_vk_id', props.searchObject.vk_user_id);\n            fd.append('group_id', props.searchObject.vk_group_id);\n            fd.append('source', String(props.source));\n            fd.append('tag_id', props.tag_id);\n\n            fd.append('utm_source', props.hashObject['utm_source'] || '');\n            fd.append('utm_medium', props.hashObject['utm_medium'] || '');\n            fd.append('utm_campaign', props.hashObject['utm_campaign'] || '');\n            fd.append('utm_content', props.hashObject['utm_content'] || '');\n            fd.append('utm_term', props.hashObject['utm_term'] || '');\n            fd.append('params', JSON.stringify(props.searchObject));\n\n            const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({\n                method: 'vkapp.unsubscribe_all',\n            }), { method: 'POST', body: fd });\n\n\n            const data = await res.json();\n\n            if (data.status !== 'ok') {\n                throw new Error(data.text || 'Что-то пошло не так. Не удалось отписаться');\n            }\n\n            props.dispatch({ type: 'UNSUBSCRIBE_ALL' });\n\n        } catch (error) {\n            alert(error.toString());\n        }\n\n    };\n\n    return (\n        <div style={{ textAlign: 'center' }}>\n            <button\n                data-source=\"1\" style={{ backgroundColor: props.unsubscribe_color }}\n                className=\"subscriptions-group-button unsubscribe-button unsubscribe-all\"\n                onClick={() => unsubscribeAll()}\n                id=\"unsubscribe-all\">Отписаться от всех рассылок</button>\n        </div>\n    );\n};\n\nexport default connect(state => ({\n    subscribesCount: state.subscribesCount,\n    searchObject: state.searchObject,\n    hashObject: state.hashObject    \n}))(UnsubscribeAll);","import React, { useEffect } from 'react';\nimport bridge from '@vkontakte/vk-bridge';\nimport View from '@vkontakte/vkui/dist/components/View/View';\nimport { connect } from 'react-redux';\nimport '@vkontakte/vkui/dist/vkui.css';\nimport './css/vkapp.css';\n\nimport { Panel, PanelHeader, ScreenSpinner } from '@vkontakte/vkui';\nimport SubscriptionsList from './components/SubscribersList';\nimport UnsubscribeAll from './components/UnsubscribeAll';\n\nconst getObjectFromURL = (url) => {\n    const search = url.slice(1);\n    const params = search.split('&');\n\n    return params.reduce((acc, item) => {\n\n        const [key, value] = item.split('=');\n\n        acc[key] = value;\n\n        return acc;\n    }, {});\n};\n\nconst buildQuery = (params) => {\n    return Object.entries(params).map((item) => item.join('=')).join('&');\n}\n\nconst hashObject = getObjectFromURL(window.location.hash);\nconst searchObject = getObjectFromURL(window.location.search);\n\nconst vk_group_id = searchObject.vk_group_id || '';\nconst user_vk_id = searchObject.vk_user_id;\n\nconst mapStateToProps = state => ({\n    loading: state.loading,\n    popout: state.popout\n});\n\nconst loadSubscriptions = () => {\n    return dispatch => {\n        dispatch({ type: 'LOAD_BEGIN' });\n        fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({ method: 'vkapp.load_info', group_id: vk_group_id, user_vk_id }))\n            .then(response => response.json())\n            .then(json => {\n                const subscribesCount = json.subscriptions.filter(item => item.isSubscribed === true).length\n                dispatch({ type: 'INFO_LOADED', payload: { ...json, searchObject, hashObject, subscribesCount } });\n            })\n    }\n}\nbridge.subscribe(event => {\n    console.log(event);\n});\n\nconst App = ({ loading, dispatch, unsubscribe_color, popout }) => {\n\n    console.log('call app');\n\n\n    useEffect(() => {\n        dispatch(loadSubscriptions());\n    }, [dispatch, loadSubscriptions])\n\n    if (loading) {\n        return <ScreenSpinner size=\"large\" />;\n    }\n\n    return (\n        <View popout={popout} activePanel=\"main\">\n            <Panel id=\"main\">\n                <PanelHeader>Рассылка сообщений</PanelHeader>\n                <SubscriptionsList />\n                <UnsubscribeAll unsubscribe_color={unsubscribe_color} />\n            </Panel>\n        </View >\n    );\n}\n\nexport default connect(mapStateToProps)(App);\n\n","import 'core-js/features/map';\nimport 'core-js/features/set';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport bridge from '@vkontakte/vk-bridge';\nimport App from './App';\nimport { Provider } from 'react-redux';\nimport { createStore, applyMiddleware } from 'redux'\nimport thunk from 'redux-thunk';\nimport { ScreenSpinner } from '@vkontakte/vkui';\n\n// Init VK  Mini App\nbridge.send('VKWebAppInit');\n\nconst initialState = {\n    subscriptions: [],\n    loading: true,\n    subscribesCount: 0,\n    showUnsubscribeAll: false,\n};\n\nfunction MyReducer(state = initialState, action) {\n\n    switch (action.type) {\n\n        case 'LOAD_BEGIN':\n            return { ...state, loading: true, };\n\n        case 'INFO_LOADED':\n            return { ...state, ...action.payload, loading: false, }\n\n        case 'TOGGLE_SUBSCRIBE':\n            return {\n                ...state,\n                subscribesCount: state.subscribesCount + 1 * (action.payload.type === 'subscribe' ? 1 : -1),\n                subscriptions: state.subscriptions.map(sub => (sub.id === action.payload.id) ? { ...sub, isSubscribed: (action.payload.type === 'subscribe') ? true : false, count: (action.payload.type === 'subscribe') ? sub.count + 1 : sub.count - 1 } : sub)\n            }\n        // return { ...state, ...action.payload }\n\n        case 'UNSUBSCRIBE_ALL':\n\n            return {\n                ...state,\n                subscriptions: state.subscriptions.map(item => (item.isSubscribed ? { ...item, isSubscribed: false } : item)),\n                subscribesCount: 0\n            }\n    }\n\n    return state;\n}\n\nconst store = createStore(MyReducer, applyMiddleware(thunk));\n\nReactDOM.render((\n    <Provider store={store}>\n        <App />\n    </Provider>\n), document.getElementById('root'));\n"],"sourceRoot":""}