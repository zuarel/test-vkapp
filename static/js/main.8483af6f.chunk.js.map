{"version":3,"sources":["components/SubscriptionItem.js","App.js","index.js"],"names":["SubscriptionItem","props","item","source","subscribe","unsubscribe","isSubscriptionPage","unsubscribeColor","subscribeColor","className","name","count","isSubscribed","data-source","onClick","style","backgroundColor","getObjectFromURL","url","slice","split","reduce","acc","key","value","buildQuery","params","Object","entries","map","join","App","hashObject","window","location","hash","searchObject","search","vk_group_id","user_vk_id","vk_user_id","subscriptionId","s","tag_id","u","useState","subscriptions","setSubscriptions","isGroupInfoLoading","setGroupInfoLoading","popout","setPopout","description","avatar","banner","groupInfo","setGroupInfo","loadGroupInfo","a","fetch","method","group_id","res","json","data","status","Error","subscribe_color","unsubscribe_color","actions","title","autoclose","onClose","message","find","subscription","id","pageDescription","subscribeItem","fd","FormData","append","String","JSON","stringify","body","text","i","lastPressedItem","connect","detail","type","onSubscribe","showSpinner","res1","is_messages_from_group_allowed","send","openSubscribeModal","alert","toString","unsubscribeItem","onUnsubscribe","openUnsubscribeModal","unsubscribeAll","showDialogLink","top","href","size","stretched","useEffect","activePanel","textAlign","src","alt","maxWidth","padding","borderRadius","marginRight","filter","length","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.8483af6f.chunk.js","sourcesContent":["import React from 'react';\r\n\r\n\r\nconst SubscriptionItem = (props) => {\r\n    const {\r\n        item,\r\n        source,\r\n        subscribe,\r\n        unsubscribe,\r\n        isSubscriptionPage,\r\n        unsubscribeColor,\r\n        subscribeColor\r\n    } = props;\r\n    \r\n    return (\r\n        <div className={`subscriptions-group-item ${isSubscriptionPage && 'subscription-page'}`}>\r\n            <div className=\"subscriptions-group-item__info\">\r\n                <p className=\"subscriptions-group-item__title\">{item.name}</p>\r\n                <p className=\"subscriptions-group-item__count\">Подписчиков: {item.count}</p>\r\n            </div>\r\n            <div className=\"subscriptions-group-item__action-block\">\r\n\r\n                {item.isSubscribed\r\n                    ? <button data-source={source}\r\n                        onClick={() => unsubscribe(item)}\r\n                        style={{backgroundColor: unsubscribeColor ? unsubscribeColor : ''}}\r\n                        className=\"subscriptions-group-button unsubscribe-button\">Отписаться</button>\r\n                    : <button data-source={source}\r\n                        onClick={() => subscribe(item)}\r\n                        style={{backgroundColor: subscribeColor ? subscribeColor : ''}}\r\n                        className=\"subscriptions-group-button subscribe-button\">Подписаться</button>\r\n                }\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default SubscriptionItem;","import React, { useState, useEffect } from 'react';\r\nimport connect from '@vkontakte/vk-connect';\r\nimport View from '@vkontakte/vkui/dist/components/View/View';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport './css/vkapp.css';\r\n\r\nimport { Panel, PanelHeader, Alert, Div, Button, ScreenSpinner } from '@vkontakte/vkui';\r\nimport SubscriptionItem from './components/SubscriptionItem';\r\n\r\nconst getObjectFromURL = (url) => {\r\n    const search = url.slice(1);\r\n    const params = search.split('&');\r\n\r\n    return params.reduce((acc, item) => {\r\n\r\n        const [key, value] = item.split('=');\r\n\r\n        acc[key] = value;\r\n\r\n        return acc;\r\n    }, {});\r\n};\r\n\r\nconst buildQuery = (params) => {\r\n    return Object.entries(params).map((item) => item.join('=')).join('&');\r\n}\r\n\r\nconst App = () => {\r\n\r\n    const hashObject = getObjectFromURL(window.location.hash);\r\n    const searchObject = getObjectFromURL(window.location.search);\r\n\r\n    const vk_group_id = searchObject.vk_group_id || '';\r\n    const user_vk_id = searchObject.vk_user_id;\r\n    const subscriptionId = hashObject.s || '';\r\n    var tag_id = hashObject.u || '';\r\n\r\n    const [subscriptions, setSubscriptions] = useState([]);\r\n    const [isGroupInfoLoading, setGroupInfoLoading] = useState(false);\r\n    const [popout, setPopout] = useState(null);\r\n    const [groupInfo, setGroupInfo] = useState({\r\n        description: '',\r\n        avatar: '',\r\n        name: '',\r\n        banner: '',\r\n        unsubscribeColor: '',\r\n        subscribeColor: ''\r\n    });\r\n\r\n    const loadGroupInfo = async () => {\r\n        if (isGroupInfoLoading) {\r\n            return;\r\n        }\r\n\r\n        setGroupInfoLoading(true);\r\n\r\n        try {\r\n            const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({ method: 'vkapp.load_info', group_id: vk_group_id, user_vk_id }));\r\n            const { subscriptions, ...data } = await res.json();\r\n\r\n\r\n            if (data.status !== 'ok') {\r\n                throw new Error('Не удалось загрузить данные.');\r\n            }\r\n\r\n            setGroupInfo({\r\n                ...groupInfo,\r\n                description: data.description,\r\n                avatar: data.avatar,\r\n                name: data.name,\r\n                banner: data.banner,\r\n                subscribeColor: data.subscribe_color,\r\n                unsubscribeColor: data.unsubscribe_color\r\n            });\r\n\r\n            setSubscriptions(subscriptions);\r\n        } catch (error) {\r\n            setGroupInfoLoading(true);\r\n\r\n            setPopout(<Alert\r\n                actions={[{\r\n                    title: 'закрыть',\r\n                    autoclose: true,\r\n                    style: 'cancel'\r\n                }]}\r\n                onClose={() => setPopout(null)}\r\n            >\r\n                <h2>Что-то пошло не так.</h2>\r\n                <p>{error.message}</p>\r\n            </Alert>);\r\n        }\r\n    };\r\n\r\n    const source = subscriptionId ? 2 : 1;\r\n\r\n    const item = subscriptions.find(subscription => subscription.id === subscriptionId);\r\n\r\n    const pageDescription = item\r\n        ? (item.description || '')\r\n        : groupInfo.description || '';\r\n\r\n    const subscribeItem = async (item) => {\r\n\r\n        var fd = new FormData();\r\n\r\n        fd.append('user_vk_id', user_vk_id);\r\n        fd.append('group_id', vk_group_id);\r\n        fd.append('subscribe_id', item.id);\r\n        fd.append('source', String(source));\r\n        fd.append('tag_id', tag_id);\r\n\r\n        fd.append('utm_source', hashObject['utm_source'] || '');\r\n        fd.append('utm_medium', hashObject['utm_medium'] || '');\r\n        fd.append('utm_campaign', hashObject['utm_campaign'] || '');\r\n        fd.append('utm_content', hashObject['utm_content'] || '');\r\n        fd.append('utm_term', hashObject['utm_term'] || '');\r\n        fd.append('params', JSON.stringify(searchObject));\r\n\r\n        const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({ method: 'vkapp.subscribe_user', }),\r\n            { method: 'POST', body: fd });\r\n\r\n        const { status, ...data } = await res.json();\r\n\r\n        if (status !== 'ok') {\r\n            throw new Error(data.text || 'Что-то пошло не так. Не удалось подписаться');\r\n        }\r\n\r\n        const s = subscriptions.map(item => item);\r\n        const i = s.find(subscription => subscription.id === item.id);\r\n\r\n        i.isSubscribed = true;\r\n        i.count = item.count + 1\r\n\r\n        setSubscriptions(s);\r\n    };\r\n\r\n    let lastPressedItem = null;\r\n\r\n    connect.subscribe(async ({ detail: { type } }) => {\r\n        if (type === 'VKWebAppAllowMessagesFromGroupResult') {\r\n            await subscribeItem(lastPressedItem);\r\n        }\r\n    });\r\n\r\n    const onSubscribe = async (item) => {\r\n\r\n        showSpinner();\r\n\r\n        lastPressedItem = item;\r\n\r\n        try {\r\n            const res1 = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({\r\n                user_vk_id,\r\n                method: 'vkapp.check_allowed',\r\n                group_id: vk_group_id,\r\n            }));\r\n\r\n            const { is_messages_from_group_allowed } = await res1.json();\r\n\r\n            if (!is_messages_from_group_allowed) {\r\n                connect.send('VKWebAppAllowMessagesFromGroup', { group_id: +vk_group_id });\r\n                setPopout(null);\r\n                return;\r\n            }\r\n\r\n            await subscribeItem(item);\r\n            openSubscribeModal(true);\r\n        } catch (error) {\r\n            setPopout(null);\r\n            alert(error.toString());\r\n        }\r\n\r\n        lastPressedItem = null;\r\n    };\r\n\r\n    const unsubscribeItem = async (item) => {\r\n\r\n        const fd = new FormData();\r\n\r\n        fd.append('user_vk_id', user_vk_id);\r\n        fd.append('group_id', vk_group_id);\r\n        fd.append('subscribe_id', item.id);\r\n        fd.append('source', String(source));\r\n        fd.append('tag_id', tag_id);\r\n\r\n        fd.append('utm_source', hashObject['utm_source'] || '');\r\n        fd.append('utm_medium', hashObject['utm_medium'] || '');\r\n        fd.append('utm_campaign', hashObject['utm_campaign'] || '');\r\n        fd.append('utm_content', hashObject['utm_content'] || '');\r\n        fd.append('utm_term', hashObject['utm_term'] || '');\r\n        fd.append('params', JSON.stringify(searchObject));\r\n\r\n        const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({\r\n            method: 'vkapp.unsubscribe_user',\r\n        }), { method: 'POST', body: fd });\r\n\r\n        const { status, ...data } = await res.json();\r\n\r\n        if (status !== 'ok') {\r\n            throw new Error(data.text || 'Что-то пошло не так. Не удалось отписаться');\r\n        }\r\n\r\n        item.isSubscribed = false;\r\n        item.count = item.count - 1\r\n\r\n        return item;\r\n    }\r\n\r\n    const onUnsubscribe = async (item) => {\r\n        try {\r\n            showSpinner();\r\n\r\n            var s = subscriptions.map(item => item);\r\n            var i = s.find(subscription => subscription.id === item.id);\r\n\r\n            await unsubscribeItem(i);\r\n\r\n            setSubscriptions(s);\r\n            openUnsubscribeModal();\r\n        } catch (error) {\r\n            setPopout(null);\r\n            alert(error.message);\r\n        }\r\n    };\r\n\r\n    const unsubscribeAll = async () => {\r\n\r\n        showSpinner();\r\n        try {\r\n\r\n            const fd = new FormData();\r\n\r\n            fd.append('user_vk_id', user_vk_id);\r\n            fd.append('group_id', vk_group_id);\r\n            fd.append('source', String(source));\r\n            fd.append('tag_id', tag_id);\r\n\r\n            fd.append('utm_source', hashObject['utm_source'] || '');\r\n            fd.append('utm_medium', hashObject['utm_medium'] || '');\r\n            fd.append('utm_campaign', hashObject['utm_campaign'] || '');\r\n            fd.append('utm_content', hashObject['utm_content'] || '');\r\n            fd.append('utm_term', hashObject['utm_term'] || '');\r\n            fd.append('params', JSON.stringify(searchObject));\r\n\r\n            const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({\r\n                method: 'vkapp.unsubscribe_all',\r\n            }), { method: 'POST', body: fd });\r\n\r\n\r\n            const data = await res.json();\r\n\r\n            if (data.status !== 'ok') {\r\n                throw new Error(data.text || 'Что-то пошло не так. Не удалось отписаться');\r\n            }\r\n\r\n            showSpinner();\r\n\r\n            const s = subscriptions.map(item => item);\r\n\r\n            for (const subscription of s) {\r\n                \r\n                if (!subscription.isSubscribed) {\r\n                    continue;\r\n                }\r\n\r\n                subscription.isSubscribed = false;\r\n                subscription.count = subscription.count - 1\r\n            }\r\n\r\n            setSubscriptions(s);\r\n            openUnsubscribeModal();\r\n        } catch (error) {\r\n            setPopout(null);\r\n            alert(error.toString());\r\n        }\r\n\r\n    };\r\n\r\n    const openSubscribeModal = (showDialogLink) => {\r\n\r\n        setPopout(<Alert\r\n            actions={[{\r\n                title: 'закрыть',\r\n                autoclose: true,\r\n                style: 'cancel'\r\n            }]}\r\n            onClose={() => setPopout(null)}\r\n        >\r\n            <h2>Вы успешно подписались на рссылку.</h2>\r\n            <p>Рассылка скоро придёт Вам в личные сообщения.</p>\r\n\r\n            {showDialogLink && <Div>\r\n                <Button onClick={() => window.top.location.href = 'https://vk.com/im?sel=-' + vk_group_id} size=\"l\" stretched>Перейти к сообщениям</Button>\r\n            </Div>}\r\n        </Alert>);\r\n    }\r\n\r\n    const openUnsubscribeModal = () => {\r\n        setPopout(<Alert\r\n            actions={[{\r\n                title: 'закрыть',\r\n                autoclose: true,\r\n                style: 'cancel'\r\n            }]}\r\n            onClose={() => setPopout(null)}\r\n        >\r\n            <h2>Вы отписаны.</h2>\r\n            <p>Рассылка Вам больше не будет приходить.</p>\r\n        </Alert>);\r\n    }\r\n\r\n    const showSpinner = () => {\r\n        setPopout(<ScreenSpinner size=\"large\" />);\r\n    }\r\n\r\n    useEffect(() => {\r\n        loadGroupInfo();\r\n    });\r\n\r\n    return (\r\n        <View popout={popout} activePanel=\"main\">\r\n            <Panel id=\"main\">\r\n                <PanelHeader>Рассылка сообщений</PanelHeader>\r\n                <div style={{ textAlign: 'center' }}>\r\n                    {item && item.banner\r\n                        && <img src={item.banner} alt=\"Баннер\" style={{ maxWidth: '100%' }}></img>}\r\n\r\n                    {groupInfo.banner\r\n                        && <img src={groupInfo.banner} alt=\"Баннер\" style={{ maxWidth: '100%' }}></img>}\r\n                </div>\r\n\r\n                <div style={{ padding: '15px' }}>\r\n\r\n                    {((!item || !item.banner) && !groupInfo.banner)\r\n                        && <p className=\"page-title\">\r\n                            <img src={groupInfo.avatar} alt=\"Аватарка паблика\" style={{ borderRadius: '50%', marginRight: '16px' }} />\r\n                            {groupInfo.name}</p>\r\n                    }\r\n\r\n                    <p className=\"page-description\">{pageDescription}</p>\r\n\r\n\r\n                    {subscriptions.filter(subscription => (!subscriptionId || subscription.id === subscriptionId)).map(subscription =>\r\n                        <SubscriptionItem\r\n                            item={subscription}\r\n                            source={source}\r\n                            subscribe={onSubscribe}\r\n                            unsubscribe={onUnsubscribe}\r\n                            subscribeColor={groupInfo.subscribeColor}\r\n                            unsubscribeColor={groupInfo.unsubscribeColor}\r\n                            isSubscriptionPage={!!item}\r\n                            key={subscription.id} />\r\n                    )}\r\n\r\n                    {subscriptions.filter(item => item.isSubscribed).length > 0 && <div style={{ textAlign: 'center' }}>\r\n                        <button\r\n                            onClick={unsubscribeAll}\r\n                            data-source=\"1\" style={{ backgroundColor: groupInfo.unsubscribeColor }}\r\n                            className=\"subscriptions-group-button unsubscribe-button unsubscribe-all\"\r\n                            id=\"unsubscribe-all\">Отписаться от всех рассылок</button>\r\n                    </div>}\r\n                </div>\r\n            </Panel>\r\n        </View >\r\n    );\r\n}\r\n\r\nexport default App;\r\n\r\n","import 'core-js/features/map';\r\nimport 'core-js/features/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport connect from '@vkontakte/vk-connect';\r\nimport App from './App';\r\n// import registerServiceWorker from './sw';\r\n\r\n// Init VK  Mini App\r\nconnect.send('VKWebAppInit');\r\n\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\r\n// registerServiceWorker();\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n"],"sourceRoot":""}