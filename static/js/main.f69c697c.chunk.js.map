{"version":3,"sources":["components/SubscriptionItem.js","App.js","index.js"],"names":["SubscriptionItem","props","item","source","subscribe","unsubscribe","isSubscriptionPage","unsubscribeColor","subscribeColor","className","name","count","isSubscribed","data-source","onClick","style","backgroundColor","getObjectFromURL","url","slice","split","reduce","acc","key","value","buildQuery","params","Object","entries","map","join","App","hashObject","window","location","hash","searchObject","search","vk_group_id","user_vk_id","vk_user_id","subscriptionId","s","tag_id","u","useState","subscriptions","setSubscriptions","isGroupInfoLoading","setGroupInfoLoading","popout","setPopout","description","avatar","banner","groupInfo","setGroupInfo","loadGroupInfo","a","fetch","method","group_id","res","json","data","status","Error","subscribe_color","unsubscribe_color","actions","title","autoclose","onClose","message","find","subscription","id","pageDescription","subscribeItem","fd","FormData","append","String","JSON","stringify","body","text","i","lastPressedItem","connect","detail","type","onSubscribe","showSpinner","res1","is_messages_from_group_allowed","send","openSubscribeModal","alert","toString","unsubscribeItem","onUnsubscribe","openUnsubscribeModal","unsubscribeAll","showDialogLink","top","href","size","stretched","useEffect","activePanel","textAlign","src","alt","maxWidth","padding","borderRadius","marginRight","filter","length","ReactDOM","render","document","getElementById"],"mappings":"ulBAsCeA,EAnCU,SAACC,GAAW,IAE7BC,EAOAD,EAPAC,KACAC,EAMAF,EANAE,OACAC,EAKAH,EALAG,UACAC,EAIAJ,EAJAI,YACAC,EAGAL,EAHAK,mBACAC,EAEAN,EAFAM,iBACAC,EACAP,EADAO,eAGJ,OACI,yBAAKC,UAAS,mCAA8BH,GAAsB,sBAC9D,yBAAKG,UAAU,kCACX,uBAAGA,UAAU,mCAAmCP,EAAKQ,MACrD,uBAAGD,UAAU,mCAAb,uEAA6DP,EAAKS,QAEtE,yBAAKF,UAAU,0CAEVP,EAAKU,aACA,4BAAQC,cAAaV,EACnBW,QAAS,kBAAMT,EAAYH,IAC3Ba,MAAO,CAACC,gBAAiBT,GAAsC,IAC/DE,UAAU,iDAHZ,gEAIA,4BAAQI,cAAaV,EACnBW,QAAS,kBAAMV,EAAUF,IACzBa,MAAO,CAACC,gBAAiBR,GAAkC,IAC3DC,UAAU,+CAHZ,yEClBhBQ,EAAmB,SAACC,GAItB,OAHeA,EAAIC,MAAM,GACHC,MAAM,KAEdC,QAAO,SAACC,EAAKpB,GAAU,IAAD,EAEXA,EAAKkB,MAAM,KAFA,mBAEzBG,EAFyB,KAEpBC,EAFoB,KAMhC,OAFAF,EAAIC,GAAOC,EAEJF,IACR,KAGDG,EAAa,SAACC,GAChB,OAAOC,OAAOC,QAAQF,GAAQG,KAAI,SAAC3B,GAAD,OAAUA,EAAK4B,KAAK,QAAMA,KAAK,MAuVtDC,EApVH,WAER,IAAMC,EAAaf,EAAiBgB,OAAOC,SAASC,MAC9CC,EAAenB,EAAiBgB,OAAOC,SAASG,QAEhDC,EAAcF,EAAaE,aAAe,GAC1CC,EAAaH,EAAaI,WAC1BC,EAAiBT,EAAWU,GAAK,GACnCC,EAASX,EAAWY,GAAK,GARf,EAU4BC,mBAAS,IAVrC,mBAUPC,EAVO,KAUQC,EAVR,OAWoCF,oBAAS,GAX7C,mBAWPG,EAXO,KAWaC,EAXb,OAYcJ,mBAAS,MAZvB,mBAYPK,EAZO,KAYCC,EAZD,OAaoBN,mBAAS,CACvCO,YAAa,GACbC,OAAQ,GACR3C,KAAM,GACN4C,OAAQ,GACR/C,iBAAkB,GAClBC,eAAgB,KAnBN,mBAaP+C,EAbO,KAaIC,EAbJ,KAsBRC,EAAa,uCAAG,kCAAAC,EAAA,0DACdV,EADc,wDAKlBC,GAAoB,GALF,kBAQIU,MAAM,uCAAyClC,EAAW,CAAEmC,OAAQ,kBAAmBC,SAAUvB,EAAaC,gBARlH,cAQRuB,EARQ,gBAS2BA,EAAIC,OAT/B,mBASNjB,EATM,EASNA,cAGY,QAHMkB,EATZ,kCAYLC,OAZK,uBAaJ,IAAIC,MAAM,wJAbN,QAgBdV,EAAa,eACND,EADK,CAERH,YAAaY,EAAKZ,YAClBC,OAAQW,EAAKX,OACb3C,KAAMsD,EAAKtD,KACX4C,OAAQU,EAAKV,OACb9C,eAAgBwD,EAAKG,gBACrB5D,iBAAkByD,EAAKI,qBAG3BrB,EAAiBD,GA1BH,kDA4BdG,GAAoB,GAEpBE,EAAU,kBAAC,IAAD,CACNkB,QAAS,CAAC,CACNC,MAAO,6CACPC,WAAW,EACXxD,MAAO,WAEXyD,QAAS,kBAAMrB,EAAU,QAEzB,+HACA,2BAAI,KAAMsB,WAvCA,0DAAH,qDA4CbtE,EAASsC,EAAiB,EAAI,EAE9BvC,EAAO4C,EAAc4B,MAAK,SAAAC,GAAY,OAAIA,EAAaC,KAAOnC,KAE9DoC,EAAkB3E,EACjBA,EAAKkD,aAAe,GACrBG,EAAUH,aAAe,GAEzB0B,EAAa,uCAAG,WAAO5E,GAAP,2BAAAwD,EAAA,6DAEdqB,EAAK,IAAIC,UAEVC,OAAO,aAAc1C,GACxBwC,EAAGE,OAAO,WAAY3C,GACtByC,EAAGE,OAAO,eAAgB/E,EAAK0E,IAC/BG,EAAGE,OAAO,SAAUC,OAAO/E,IAC3B4E,EAAGE,OAAO,SAAUtC,GAEpBoC,EAAGE,OAAO,aAAcjD,EAAU,YAAkB,IACpD+C,EAAGE,OAAO,aAAcjD,EAAU,YAAkB,IACpD+C,EAAGE,OAAO,eAAgBjD,EAAU,cAAoB,IACxD+C,EAAGE,OAAO,cAAejD,EAAU,aAAmB,IACtD+C,EAAGE,OAAO,WAAYjD,EAAU,UAAgB,IAChD+C,EAAGE,OAAO,SAAUE,KAAKC,UAAUhD,IAfjB,UAiBAuB,MAAM,uCAAyClC,EAAW,CAAEmC,OAAQ,yBAClF,CAAEA,OAAQ,OAAQyB,KAAMN,IAlBV,eAiBZjB,EAjBY,iBAoBgBA,EAAIC,OApBpB,oBAoBVE,EApBU,EAoBVA,OAAWD,EApBD,0BAsBH,OAAXC,EAtBc,uBAuBR,IAAIC,MAAMF,EAAKsB,MAAQ,8NAvBf,QA0BZ5C,EAAII,EAAcjB,KAAI,SAAA3B,GAAI,OAAIA,MAC9BqF,EAAI7C,EAAEgC,MAAK,SAAAC,GAAY,OAAIA,EAAaC,KAAO1E,EAAK0E,OAExDhE,cAAe,EACjB2E,EAAE5E,MAAQT,EAAKS,MAAQ,EAEvBoC,EAAiBL,GAhCC,4CAAH,sDAmCf8C,EAAkB,KAEtBC,IAAQrF,UAAR,uCAAkB,uBAAAsD,EAAA,yDACD,yCADC,EAASgC,OAAUC,KAAnB,gCAEJb,EAAcU,GAFV,2CAAlB,uDAMA,IAAMI,EAAW,uCAAG,WAAO1F,GAAP,iBAAAwD,EAAA,6DAEhBmC,IAEAL,EAAkBtF,EAJF,kBAOOyD,MAAM,uCAAyClC,EAAW,CACzEc,aACAqB,OAAQ,sBACRC,SAAUvB,KAVF,cAONwD,EAPM,gBAaqCA,EAAK/B,OAb1C,qBAaJgC,+BAbI,wBAgBRN,IAAQO,KAAK,iCAAkC,CAAEnC,UAAWvB,IAC5Da,EAAU,MAjBF,4CAqBN2B,EAAc5E,GArBR,QAsBZ+F,GAAmB,GAtBP,kDAwBZ9C,EAAU,MACV+C,MAAM,KAAMC,YAzBA,QA4BhBX,EAAkB,KA5BF,0DAAH,sDA+BXY,EAAe,uCAAG,WAAOlG,GAAP,uBAAAwD,EAAA,6DAEdqB,EAAK,IAAIC,UAEZC,OAAO,aAAc1C,GACxBwC,EAAGE,OAAO,WAAY3C,GACtByC,EAAGE,OAAO,eAAgB/E,EAAK0E,IAC/BG,EAAGE,OAAO,SAAUC,OAAO/E,IAC3B4E,EAAGE,OAAO,SAAUtC,GAEpBoC,EAAGE,OAAO,aAAcjD,EAAU,YAAkB,IACpD+C,EAAGE,OAAO,aAAcjD,EAAU,YAAkB,IACpD+C,EAAGE,OAAO,eAAgBjD,EAAU,cAAoB,IACxD+C,EAAGE,OAAO,cAAejD,EAAU,aAAmB,IACtD+C,EAAGE,OAAO,WAAYjD,EAAU,UAAgB,IAChD+C,EAAGE,OAAO,SAAUE,KAAKC,UAAUhD,IAff,UAiBFuB,MAAM,uCAAyClC,EAAW,CACxEmC,OAAQ,2BACR,CAAEA,OAAQ,OAAQyB,KAAMN,IAnBR,eAiBdjB,EAjBc,iBAqBcA,EAAIC,OArBlB,oBAqBZE,EArBY,EAqBZA,OAAWD,EArBC,0BAuBL,OAAXC,EAvBgB,uBAwBV,IAAIC,MAAMF,EAAKsB,MAAQ,wNAxBb,eA2BpBpF,EAAKU,cAAe,EACpBV,EAAKS,MAAQT,EAAKS,MAAQ,EA5BN,kBA8BbT,GA9Ba,4CAAH,sDAiCfmG,EAAa,uCAAG,WAAOnG,GAAP,iBAAAwD,EAAA,sEAEdmC,IAEInD,EAAII,EAAcjB,KAAI,SAAA3B,GAAI,OAAIA,KAC9BqF,EAAI7C,EAAEgC,MAAK,SAAAC,GAAY,OAAIA,EAAaC,KAAO1E,EAAK0E,MAL1C,SAORwB,EAAgBb,GAPR,OASdxC,EAAiBL,GACjB4D,IAVc,kDAYdnD,EAAU,MACV+C,MAAM,KAAMzB,SAbE,0DAAH,sDAiBb8B,EAAc,uCAAG,8CAAA7C,EAAA,6DAEnBmC,IAFmB,UAKTd,EAAK,IAAIC,UAEZC,OAAO,aAAc1C,GACxBwC,EAAGE,OAAO,WAAY3C,GACtByC,EAAGE,OAAO,SAAUC,OAAO/E,IAC3B4E,EAAGE,OAAO,SAAUtC,GAEpBoC,EAAGE,OAAO,aAAcjD,EAAU,YAAkB,IACpD+C,EAAGE,OAAO,aAAcjD,EAAU,YAAkB,IACpD+C,EAAGE,OAAO,eAAgBjD,EAAU,cAAoB,IACxD+C,EAAGE,OAAO,cAAejD,EAAU,aAAmB,IACtD+C,EAAGE,OAAO,WAAYjD,EAAU,UAAgB,IAChD+C,EAAGE,OAAO,SAAUE,KAAKC,UAAUhD,IAjBpB,UAmBGuB,MAAM,uCAAyClC,EAAW,CACxEmC,OAAQ,0BACR,CAAEA,OAAQ,OAAQyB,KAAMN,IArBb,eAmBTjB,EAnBS,iBAwBIA,EAAIC,OAxBR,WA0BK,QAFdC,EAxBS,QA0BNC,OA1BM,uBA2BL,IAAIC,MAAMF,EAAKsB,MAAQ,wNA3BlB,QA8BfO,IAEMnD,EAAII,EAAcjB,KAAI,SAAA3B,GAAI,OAAIA,KAhCrB,+BAkCYwC,EAlCZ,uEAkCJiC,EAlCI,SAoCO/D,aApCP,wDAwCX+D,EAAa/D,cAAe,EAC5B+D,EAAahE,MAAQgE,EAAahE,MAAQ,EAzC/B,+QA4CfoC,EAAiBL,GACjB4D,IA7Ce,kDA+CfnD,EAAU,MACV+C,MAAM,KAAMC,YAhDG,oFAAH,qDAqDdF,EAAqB,SAACO,GAExBrD,EAAU,kBAAC,IAAD,CACNkB,QAAS,CAAC,CACNC,MAAO,6CACPC,WAAW,EACXxD,MAAO,WAEXyD,QAAS,kBAAMrB,EAAU,QAEzB,mNACA,0QAECqD,GAAkB,kBAAC,IAAD,KACf,kBAAC,IAAD,CAAQ1F,QAAS,kBAAMmB,OAAOwE,IAAIvE,SAASwE,KAAO,0BAA4BpE,GAAaqE,KAAK,IAAIC,WAAS,GAA7G,sHAKNN,EAAuB,WACzBnD,EAAU,kBAAC,IAAD,CACNkB,QAAS,CAAC,CACNC,MAAO,6CACPC,WAAW,EACXxD,MAAO,WAEXyD,QAAS,kBAAMrB,EAAU,QAEzB,8FACA,8OAIF0C,EAAc,WAChB1C,EAAU,kBAAC,IAAD,CAAewD,KAAK,YAOlC,OAJAE,qBAAU,WACNpD,OAIA,kBAAC,IAAD,CAAMP,OAAQA,EAAQ4D,YAAY,QAC9B,kBAAC,IAAD,CAAOlC,GAAG,QACN,kBAAC,IAAD,gHACA,yBAAK7D,MAAO,CAAEgG,UAAW,WACpB7G,GAAQA,EAAKoD,QACP,yBAAK0D,IAAK9G,EAAKoD,OAAQ2D,IAAI,uCAASlG,MAAO,CAAEmG,SAAU,UAE7D3D,EAAUD,QACJ,yBAAK0D,IAAKzD,EAAUD,OAAQ2D,IAAI,uCAASlG,MAAO,CAAEmG,SAAU,WAGvE,yBAAKnG,MAAO,CAAEoG,QAAS,WAEfjH,IAASA,EAAKoD,UAAYC,EAAUD,QACjC,uBAAG7C,UAAU,cACZ,yBAAKuG,IAAKzD,EAAUF,OAAQ4D,IAAI,8FAAmBlG,MAAO,CAAEqG,aAAc,MAAOC,YAAa,UAC7F9D,EAAU7C,MAGnB,uBAAGD,UAAU,oBAAoBoE,GAGhC/B,EAAcwE,QAAO,SAAA3C,GAAY,OAAMlC,GAAkBkC,EAAaC,KAAOnC,KAAiBZ,KAAI,SAAA8C,GAAY,OAC3G,kBAAC,EAAD,CACIzE,KAAMyE,EACNxE,OAAQA,EACRC,UAAWwF,EACXvF,YAAagG,EACb7F,eAAgB+C,EAAU/C,eAC1BD,iBAAkBgD,EAAUhD,iBAC5BD,qBAAsBJ,EACtBqB,IAAKoD,EAAaC,QAGzB9B,EAAcwE,QAAO,SAAApH,GAAI,OAAIA,EAAKU,gBAAc2G,OAAS,GAAK,yBAAKxG,MAAO,CAAEgG,UAAW,WACpF,4BACIjG,QAASyF,EACT1F,cAAY,IAAIE,MAAO,CAAEC,gBAAiBuC,EAAUhD,kBACpDE,UAAU,gEACVmE,GAAG,mBAJP,4JC1VxBa,IAAQO,KAAK,gBASbwB,IAASC,OAAO,kBAAC,EAAD,MAASC,SAASC,eAAe,W","file":"static/js/main.f69c697c.chunk.js","sourcesContent":["import React from 'react';\n\n\nconst SubscriptionItem = (props) => {\n    const {\n        item,\n        source,\n        subscribe,\n        unsubscribe,\n        isSubscriptionPage,\n        unsubscribeColor,\n        subscribeColor\n    } = props;\n    \n    return (\n        <div className={`subscriptions-group-item ${isSubscriptionPage && 'subscription-page'}`}>\n            <div className=\"subscriptions-group-item__info\">\n                <p className=\"subscriptions-group-item__title\">{item.name}</p>\n                <p className=\"subscriptions-group-item__count\">Подписчиков: {item.count}</p>\n            </div>\n            <div className=\"subscriptions-group-item__action-block\">\n\n                {item.isSubscribed\n                    ? <button data-source={source}\n                        onClick={() => unsubscribe(item)}\n                        style={{backgroundColor: unsubscribeColor ? unsubscribeColor : ''}}\n                        className=\"subscriptions-group-button unsubscribe-button\">Отписаться</button>\n                    : <button data-source={source}\n                        onClick={() => subscribe(item)}\n                        style={{backgroundColor: subscribeColor ? subscribeColor : ''}}\n                        className=\"subscriptions-group-button subscribe-button\">Подписаться</button>\n                }\n\n            </div>\n        </div>\n    );\n};\n\nexport default SubscriptionItem;","import React, { useState, useEffect } from 'react';\nimport connect from '@vkontakte/vk-connect';\nimport View from '@vkontakte/vkui/dist/components/View/View';\nimport '@vkontakte/vkui/dist/vkui.css';\nimport './css/vkapp.css';\n\nimport { Panel, PanelHeader, Alert, Div, Button, ScreenSpinner } from '@vkontakte/vkui';\nimport SubscriptionItem from './components/SubscriptionItem';\n\nconst getObjectFromURL = (url) => {\n    const search = url.slice(1);\n    const params = search.split('&');\n\n    return params.reduce((acc, item) => {\n\n        const [key, value] = item.split('=');\n\n        acc[key] = value;\n\n        return acc;\n    }, {});\n};\n\nconst buildQuery = (params) => {\n    return Object.entries(params).map((item) => item.join('=')).join('&');\n}\n\nconst App = () => {\n\n    const hashObject = getObjectFromURL(window.location.hash);\n    const searchObject = getObjectFromURL(window.location.search);\n\n    const vk_group_id = searchObject.vk_group_id || '';\n    const user_vk_id = searchObject.vk_user_id;\n    const subscriptionId = hashObject.s || '';\n    var tag_id = hashObject.u || '';\n\n    const [subscriptions, setSubscriptions] = useState([]);\n    const [isGroupInfoLoading, setGroupInfoLoading] = useState(false);\n    const [popout, setPopout] = useState(null);\n    const [groupInfo, setGroupInfo] = useState({\n        description: '',\n        avatar: '',\n        name: '',\n        banner: '',\n        unsubscribeColor: '',\n        subscribeColor: ''\n    });\n\n    const loadGroupInfo = async () => {\n        if (isGroupInfoLoading) {\n            return;\n        }\n\n        setGroupInfoLoading(true);\n\n        try {\n            const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({ method: 'vkapp.load_info', group_id: vk_group_id, user_vk_id }));\n            const { subscriptions, ...data } = await res.json();\n\n\n            if (data.status !== 'ok') {\n                throw new Error('Не удалось загрузить данные.');\n            }\n\n            setGroupInfo({\n                ...groupInfo,\n                description: data.description,\n                avatar: data.avatar,\n                name: data.name,\n                banner: data.banner,\n                subscribeColor: data.subscribe_color,\n                unsubscribeColor: data.unsubscribe_color\n            });\n\n            setSubscriptions(subscriptions);\n        } catch (error) {\n            setGroupInfoLoading(true);\n\n            setPopout(<Alert\n                actions={[{\n                    title: 'закрыть',\n                    autoclose: true,\n                    style: 'cancel'\n                }]}\n                onClose={() => setPopout(null)}\n            >\n                <h2>Что-то пошло не так.</h2>\n                <p>{error.message}</p>\n            </Alert>);\n        }\n    };\n\n    const source = subscriptionId ? 2 : 1;\n\n    const item = subscriptions.find(subscription => subscription.id === subscriptionId);\n\n    const pageDescription = item\n        ? (item.description || '')\n        : groupInfo.description || '';\n\n    const subscribeItem = async (item) => {\n\n        var fd = new FormData();\n\n        fd.append('user_vk_id', user_vk_id);\n        fd.append('group_id', vk_group_id);\n        fd.append('subscribe_id', item.id);\n        fd.append('source', String(source));\n        fd.append('tag_id', tag_id);\n\n        fd.append('utm_source', hashObject['utm_source'] || '');\n        fd.append('utm_medium', hashObject['utm_medium'] || '');\n        fd.append('utm_campaign', hashObject['utm_campaign'] || '');\n        fd.append('utm_content', hashObject['utm_content'] || '');\n        fd.append('utm_term', hashObject['utm_term'] || '');\n        fd.append('params', JSON.stringify(searchObject));\n\n        const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({ method: 'vkapp.subscribe_user', }),\n            { method: 'POST', body: fd });\n\n        const { status, ...data } = await res.json();\n\n        if (status !== 'ok') {\n            throw new Error(data.text || 'Что-то пошло не так. Не удалось подписаться');\n        }\n\n        const s = subscriptions.map(item => item);\n        const i = s.find(subscription => subscription.id === item.id);\n\n        i.isSubscribed = true;\n        i.count = item.count + 1\n\n        setSubscriptions(s);\n    };\n\n    let lastPressedItem = null;\n\n    connect.subscribe(async ({ detail: { type } }) => {\n        if (type === 'VKWebAppAllowMessagesFromGroupResult') {\n            await subscribeItem(lastPressedItem);\n        }    \n    });\n\n    const onSubscribe = async (item) => {\n\n        showSpinner();\n\n        lastPressedItem = item;\n\n        try {\n            const res1 = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({\n                user_vk_id,\n                method: 'vkapp.check_allowed',\n                group_id: vk_group_id,\n            }));\n\n            const { is_messages_from_group_allowed } = await res1.json();\n\n            if (!is_messages_from_group_allowed) {\n                connect.send('VKWebAppAllowMessagesFromGroup', { group_id: +vk_group_id });\n                setPopout(null);\n                return;\n            }\n\n            await subscribeItem(item);\n            openSubscribeModal(true);\n        } catch (error) {\n            setPopout(null);\n            alert(error.toString());\n        }\n\n        lastPressedItem = null;\n    };\n\n    const unsubscribeItem = async (item) => {\n\n        const fd = new FormData();\n\n        fd.append('user_vk_id', user_vk_id);\n        fd.append('group_id', vk_group_id);\n        fd.append('subscribe_id', item.id);\n        fd.append('source', String(source));\n        fd.append('tag_id', tag_id);\n\n        fd.append('utm_source', hashObject['utm_source'] || '');\n        fd.append('utm_medium', hashObject['utm_medium'] || '');\n        fd.append('utm_campaign', hashObject['utm_campaign'] || '');\n        fd.append('utm_content', hashObject['utm_content'] || '');\n        fd.append('utm_term', hashObject['utm_term'] || '');\n        fd.append('params', JSON.stringify(searchObject));\n\n        const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({\n            method: 'vkapp.unsubscribe_user',\n        }), { method: 'POST', body: fd });\n\n        const { status, ...data } = await res.json();\n\n        if (status !== 'ok') {\n            throw new Error(data.text || 'Что-то пошло не так. Не удалось отписаться');\n        }\n\n        item.isSubscribed = false;\n        item.count = item.count - 1\n\n        return item;\n    }\n\n    const onUnsubscribe = async (item) => {\n        try {\n            showSpinner();\n\n            var s = subscriptions.map(item => item);\n            var i = s.find(subscription => subscription.id === item.id);\n\n            await unsubscribeItem(i);\n\n            setSubscriptions(s);\n            openUnsubscribeModal();\n        } catch (error) {\n            setPopout(null);\n            alert(error.message);\n        }\n    };\n\n    const unsubscribeAll = async () => {\n\n        showSpinner();\n        try {\n\n            const fd = new FormData();\n\n            fd.append('user_vk_id', user_vk_id);\n            fd.append('group_id', vk_group_id);\n            fd.append('source', String(source));\n            fd.append('tag_id', tag_id);\n\n            fd.append('utm_source', hashObject['utm_source'] || '');\n            fd.append('utm_medium', hashObject['utm_medium'] || '');\n            fd.append('utm_campaign', hashObject['utm_campaign'] || '');\n            fd.append('utm_content', hashObject['utm_content'] || '');\n            fd.append('utm_term', hashObject['utm_term'] || '');\n            fd.append('params', JSON.stringify(searchObject));\n\n            const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({\n                method: 'vkapp.unsubscribe_all',\n            }), { method: 'POST', body: fd });\n\n\n            const data = await res.json();\n\n            if (data.status !== 'ok') {\n                throw new Error(data.text || 'Что-то пошло не так. Не удалось отписаться');\n            }\n\n            showSpinner();\n\n            const s = subscriptions.map(item => item);\n\n            for (const subscription of s) {\n                \n                if (!subscription.isSubscribed) {\n                    continue;\n                }\n\n                subscription.isSubscribed = false;\n                subscription.count = subscription.count - 1\n            }\n\n            setSubscriptions(s);\n            openUnsubscribeModal();\n        } catch (error) {\n            setPopout(null);\n            alert(error.toString());\n        }\n\n    };\n\n    const openSubscribeModal = (showDialogLink) => {\n\n        setPopout(<Alert\n            actions={[{\n                title: 'закрыть',\n                autoclose: true,\n                style: 'cancel'\n            }]}\n            onClose={() => setPopout(null)}\n        >\n            <h2>Вы успешно подписались на рссылку.</h2>\n            <p>Рассылка скоро придёт Вам в личные сообщения.</p>\n\n            {showDialogLink && <Div>\n                <Button onClick={() => window.top.location.href = 'https://vk.com/im?sel=-' + vk_group_id} size=\"l\" stretched>Перейти к сообщениям</Button>\n            </Div>}\n        </Alert>);\n    }\n\n    const openUnsubscribeModal = () => {\n        setPopout(<Alert\n            actions={[{\n                title: 'закрыть',\n                autoclose: true,\n                style: 'cancel'\n            }]}\n            onClose={() => setPopout(null)}\n        >\n            <h2>Вы отписаны.</h2>\n            <p>Рассылка Вам больше не будет приходить.</p>\n        </Alert>);\n    }\n\n    const showSpinner = () => {\n        setPopout(<ScreenSpinner size=\"large\" />);\n    }\n\n    useEffect(() => {\n        loadGroupInfo();\n    });\n\n    return (\n        <View popout={popout} activePanel=\"main\">\n            <Panel id=\"main\">\n                <PanelHeader>Рассылка сообщений</PanelHeader>\n                <div style={{ textAlign: 'center' }}>\n                    {item && item.banner\n                        && <img src={item.banner} alt=\"Баннер\" style={{ maxWidth: '100%' }}></img>}\n\n                    {groupInfo.banner\n                        && <img src={groupInfo.banner} alt=\"Баннер\" style={{ maxWidth: '100%' }}></img>}\n                </div>\n\n                <div style={{ padding: '15px' }}>\n\n                    {((!item || !item.banner) && !groupInfo.banner)\n                        && <p className=\"page-title\">\n                            <img src={groupInfo.avatar} alt=\"Аватарка паблика\" style={{ borderRadius: '50%', marginRight: '16px' }} />\n                            {groupInfo.name}</p>\n                    }\n\n                    <p className=\"page-description\">{pageDescription}</p>\n\n\n                    {subscriptions.filter(subscription => (!subscriptionId || subscription.id === subscriptionId)).map(subscription =>\n                        <SubscriptionItem\n                            item={subscription}\n                            source={source}\n                            subscribe={onSubscribe}\n                            unsubscribe={onUnsubscribe}\n                            subscribeColor={groupInfo.subscribeColor}\n                            unsubscribeColor={groupInfo.unsubscribeColor}\n                            isSubscriptionPage={!!item}\n                            key={subscription.id} />\n                    )}\n\n                    {subscriptions.filter(item => item.isSubscribed).length > 0 && <div style={{ textAlign: 'center' }}>\n                        <button\n                            onClick={unsubscribeAll}\n                            data-source=\"1\" style={{ backgroundColor: groupInfo.unsubscribeColor }}\n                            className=\"subscriptions-group-button unsubscribe-button unsubscribe-all\"\n                            id=\"unsubscribe-all\">Отписаться от всех рассылок</button>\n                    </div>}\n                </div>\n            </Panel>\n        </View >\n    );\n}\n\nexport default App;\n\n","import 'core-js/features/map';\nimport 'core-js/features/set';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport connect from '@vkontakte/vk-connect';\nimport App from './App';\n// import registerServiceWorker from './sw';\n\n// Init VK  Mini App\nconnect.send('VKWebAppInit');\n\n\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\n// расскомментируйте строку с registerServiceWorker();\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\n// registerServiceWorker();\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}