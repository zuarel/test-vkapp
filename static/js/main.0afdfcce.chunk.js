(this["webpackJsonpth-vkapp"]=this["webpackJsonpth-vkapp"]||[]).push([[0],{174:function(e,t,n){e.exports=n(273)},252:function(e,t,n){},273:function(e,t,n){"use strict";n.r(t);n(175),n(201),n(203),n(204),n(206),n(207),n(208),n(209),n(210),n(211),n(212),n(213),n(215),n(216),n(217),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(242),n(243);var r=n(21),s=n(0),c=n.n(s),a=n(20),u=n.n(a),i=n(34),o=n.n(i),b=n(104),p=n(102),l=n.n(p),d=(n(251),n(252),n(36)),m=n(35),h=n.n(m),_=n(100),j=n(50),O=n(24),f=Object(O.b)((function(e){return{source:e.source,isSubscriptionPage:e.isSubscriptionPage,unsubscribe_color:e.unsubscribeColor,subscribe_color:e.subscribeColor,searchObject:e.searchObject,hashObject:e.hashObject}}))((function(e){console.log("from sub item");var t=e.item,n=e.dispatch,s=e.source,a=e.isSubscriptionPage,u=e.unsubscribe_color,i=e.subscribe_color,o=function(){var t=Object(j.a)(h.a.mark((function t(c){var a,u,i,o,b,p;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(a=new FormData).append("user_vk_id",e.searchObject.vk_user_id),a.append("group_id",e.searchObject.vk_group_id),a.append("subscribe_id",c.id),a.append("source",String(s)),a.append("tag_id",e.tag_id),a.append("utm_source",e.hashObject.utm_source||""),a.append("utm_medium",e.hashObject.utm_medium||""),a.append("utm_campaign",e.hashObject.utm_campaign||""),a.append("utm_content",e.hashObject.utm_content||""),a.append("utm_term",e.hashObject.utm_term||""),a.append("params",JSON.stringify(e.searchObject)),t.next=14,fetch("https://smm-n.targethunter.dev/ajax?"+(l={method:c.isSubscribed?"vkapp.unsubscribe_user":"vkapp.subscribe_user"},Object.entries(l).map((function(e){return e.join("=")})).join("&")),{method:"POST",body:a});case 14:return u=t.sent,t.next=17,u.json();case 17:if(i=t.sent,o=i.status,b=Object(_.a)(i,["status"]),"ok"===o){t.next=22;break}throw new Error(b.text||"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a. \u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f");case 22:(p=Object(r.a)({},c)).isSubscribed=!c.isSubscribed,p.count=c.isSubscribed?c.count+-1:c.count+1,n({type:"TOGGLE_SUBSCRIBE",payload:{type:c.isSubscribed?"unsubscribe":"subscribe",id:c.id}});case 26:case"end":return t.stop()}var l}),t)})));return function(e){return t.apply(this,arguments)}}();return c.a.createElement("div",{className:"subscriptions-group-item ".concat(a&&"subscription-page")},c.a.createElement("div",{className:"subscriptions-group-item__info"},c.a.createElement("p",{className:"subscriptions-group-item__title"},t.name),c.a.createElement("p",{className:"subscriptions-group-item__count"},"\u041f\u043e\u0434\u043f\u0438\u0441\u0447\u0438\u043a\u043e\u0432: ",t.count),c.a.createElement("p",null,t.id)),c.a.createElement("div",{className:"subscriptions-group-item__action-block"},t.isSubscribed?c.a.createElement("button",{"data-source":s,style:{backgroundColor:u||""},onClick:function(){return o(t)},className:"subscriptions-group-button unsubscribe-button"},"\u041e\u0442\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f"):c.a.createElement("button",{"data-source":s,style:{backgroundColor:i||""},onClick:function(){return o(t)},className:"subscriptions-group-button subscribe-button"},"\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f")))})),g=Object(O.b)((function(e){return{subscriptions:e.subscriptions,unsubscribe_color:e.unsubscribe_color}}))((function(e){var t=e.subscriptions,n=e.source;e.unsubscribe_color;return console.log("from sub list"),c.a.createElement("div",{className:"subscription-group-lists"},t.map((function(e){return c.a.createElement(f,{key:e.id,source:n,item:e})})))})),v=Object(O.b)((function(e){return{subscribesCount:e.subscribesCount,searchObject:e.searchObject,hashObject:e.hashObject}}))((function(e){if(e.subscribesCount<1)return"";console.log("from unsub all");var t=function(){var t=Object(j.a)(h.a.mark((function t(){var n,r,s;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,(n=new FormData).append("user_vk_id",e.searchObject.vk_user_id),n.append("group_id",e.searchObject.vk_group_id),n.append("source",String(e.source)),n.append("tag_id",e.tag_id),n.append("utm_source",e.hashObject.utm_source||""),n.append("utm_medium",e.hashObject.utm_medium||""),n.append("utm_campaign",e.hashObject.utm_campaign||""),n.append("utm_content",e.hashObject.utm_content||""),n.append("utm_term",e.hashObject.utm_term||""),n.append("params",JSON.stringify(e.searchObject)),t.next=14,fetch("https://smm-n.targethunter.dev/ajax?"+(c={method:"vkapp.unsubscribe_all"},Object.entries(c).map((function(e){return e.join("=")})).join("&")),{method:"POST",body:n});case 14:return r=t.sent,t.next=17,r.json();case 17:if("ok"===(s=t.sent).status){t.next=20;break}throw new Error(s.text||"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a. \u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043e\u0442\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f");case 20:e.dispatch({type:"UNSUBSCRIBE_ALL"}),t.next=26;break;case 23:t.prev=23,t.t0=t.catch(0),alert(t.t0.toString());case 26:case"end":return t.stop()}var c}),t,null,[[0,23]])})));return function(){return t.apply(this,arguments)}}();return c.a.createElement("div",{style:{textAlign:"center"}},c.a.createElement("button",{"data-source":"1",style:{backgroundColor:e.unsubscribe_color},className:"subscriptions-group-button unsubscribe-button unsubscribe-all",onClick:function(){return t()},id:"unsubscribe-all"},"\u041e\u0442\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f \u043e\u0442 \u0432\u0441\u0435\u0445 \u0440\u0430\u0441\u0441\u044b\u043b\u043e\u043a"))})),E=function(e){return e.slice(1).split("&").reduce((function(e,t){var n=t.split("="),r=Object(b.a)(n,2),s=r[0],c=r[1];return e[s]=c,e}),{})},k=E(window.location.hash),y=E(window.location.search),S=y.vk_group_id||"",C=y.vk_user_id,w=function(){return function(e){var t;e({type:"LOAD_BEGIN"}),fetch("https://smm-n.targethunter.dev/ajax?"+(t={method:"vkapp.load_info",group_id:S,user_vk_id:C},Object.entries(t).map((function(e){return e.join("=")})).join("&"))).then((function(e){return e.json()})).then((function(t){var n=t.subscriptions.filter((function(e){return!0===e.isSubscribed})).length;e({type:"INFO_LOADED",payload:Object(r.a)({},t,{searchObject:y,hashObject:k,subscribesCount:n})})}))}},N=Object(O.b)((function(e){return{loading:e.loading,popout:e.popout}}))((function(e){var t=e.loading,n=e.dispatch,r=e.unsubscribe_color,a=e.popout;return console.log("call app"),Object(s.useEffect)((function(){n(w())}),[n,w]),t?c.a.createElement(d.c,{size:"large"}):c.a.createElement(l.a,{popout:a,activePanel:"main"},c.a.createElement(d.a,{id:"main"},c.a.createElement(d.b,null,"\u0420\u0430\u0441\u0441\u044b\u043b\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439"),c.a.createElement(g,null),c.a.createElement(v,{unsubscribe_color:r})))})),x=n(41),B=n(103);o.a.send("VKWebAppInit");var I={subscriptions:[],loading:!0,subscribesCount:0,showUnsubscribeAll:!1};var L=Object(x.c)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_BEGIN":return Object(r.a)({},e,{loading:!0,popout:c.a.createElement(d.c,{size:"large"})});case"INFO_LOADED":return Object(r.a)({},e,{},t.payload,{loading:!1,popout:null});case"TOGGLE_SUBSCRIBE":return Object(r.a)({},e,{subscribesCount:e.subscribesCount+1*("subscribe"===t.payload.type?1:-1),subscriptions:e.subscriptions.map((function(e){return e.id===t.payload.id?Object(r.a)({},e,{isSubscribed:"subscribe"===t.payload.type,count:"subscribe"===t.payload.type?e.count+1:e.count-1}):e}))});case"UNSUBSCRIBE_ALL":return Object(r.a)({},e,{subscriptions:e.subscriptions.map((function(e){return e.isSubscribed?Object(r.a)({},e,{isSubscribed:!1}):e})),subscribesCount:0})}return e}),Object(x.a)(B.a));u.a.render(c.a.createElement(O.a,{store:L},c.a.createElement(N,null)),document.getElementById("root"))}},[[174,1,2]]]);
//# sourceMappingURL=main.0afdfcce.chunk.js.map