{"version":3,"sources":["components/SubscriptionItem.js","App.js","index.js"],"names":["SubscriptionItem","props","item","source","subscribe","unsubscribe","isSubscriptionPage","unsubscribeColor","subscribeColor","className","name","count","isSubscribed","data-source","onClick","style","backgroundColor","getObjectFromURL","url","slice","split","reduce","acc","key","value","buildQuery","params","Object","entries","map","join","App","hashObject","window","location","hash","searchObject","search","vk_group_id","user_vk_id","vk_user_id","subscriptionId","s","useState","subscriptions","setSubscriptions","isGroupInfoLoading","setGroupInfoLoading","description","avatar","groupInfo","setGroupInfo","loadGroupInfo","a","fetch","method","group_id","res","json","data","status","Error","subscribe_color","unsubscribe_color","find","subscription","id","pageDescription","showSpinner","subscribe_id","text","i","openSubscribeModal","alert","toString","unsubscribeItem","onUnsubscribe","openUnsubscribeModal","unsubscribeAll","popout","setPopout","actions","title","autoclose","onClose","top","href","size","stretched","useEffect","activePanel","textAlign","banner","src","alt","maxWidth","padding","borderRadius","marginRight","filter","length","connect","send","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.d80fc7d1.chunk.js","sourcesContent":["import React from 'react';\r\n\r\n\r\nconst SubscriptionItem = (props) => {\r\n    const {\r\n        item,\r\n        source,\r\n        subscribe,\r\n        unsubscribe,\r\n        isSubscriptionPage,\r\n        unsubscribeColor,\r\n        subscribeColor\r\n    } = props;\r\n    \r\n    return (\r\n        <div className={`subscriptions-group-item ${isSubscriptionPage && 'subscription-page'}`}>\r\n            <div className=\"subscriptions-group-item__info\">\r\n                <p className=\"subscriptions-group-item__title\">{item.name}</p>\r\n                <p className=\"subscriptions-group-item__count\">Подписчиков: {item.count}</p>\r\n            </div>\r\n            <div className=\"subscriptions-group-item__action-block\">\r\n\r\n                {item.isSubscribed\r\n                    ? <button data-source={source}\r\n                        onClick={() => unsubscribe(item)}\r\n                        style={{backgroundColor: unsubscribeColor ? unsubscribeColor : ''}}\r\n                        className=\"subscriptions-group-button unsubscribe-button\">Отписаться</button>\r\n                    : <button data-source={source}\r\n                        onClick={() => subscribe(item)}\r\n                        style={{backgroundColor: subscribeColor ? subscribeColor : ''}}\r\n                        className=\"subscriptions-group-button subscribe-button\">Подписаться</button>\r\n                }\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default SubscriptionItem;","import React, { useState, useEffect } from 'react';\r\n// import connect from '@vkontakte/vk-connect';\r\nimport View from '@vkontakte/vkui/dist/components/View/View';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport './css/vkapp.css';\r\n\r\nimport { Panel, PanelHeader, Alert, Div, Button, ScreenSpinner } from '@vkontakte/vkui';\r\nimport SubscriptionItem from './components/SubscriptionItem';\r\n\r\nconst getObjectFromURL = (url) => {\r\n    const search = url.slice(1);\r\n    const params = search.split('&');\r\n\r\n    return params.reduce((acc, item) => {\r\n\r\n        const [key, value] = item.split('=');\r\n\r\n        acc[key] = value;\r\n\r\n        return acc;\r\n    }, {});\r\n};\r\n\r\nconst buildQuery = (params) => {\r\n    return Object.entries(params).map((item) => item.join('=')).join('&');\r\n}\r\n\r\nconst App = () => {\r\n\r\n    const hashObject = getObjectFromURL(window.location.hash);\r\n    const searchObject = getObjectFromURL(window.location.search);\r\n\r\n    const vk_group_id = searchObject.vk_group_id || '';\r\n    // const vk_group_id = 169876045;\r\n    // const user_vk_id = 74198352;\r\n    const user_vk_id = searchObject.vk_user_id;\r\n    const subscriptionId = hashObject.s || '';\r\n\r\n    const [subscriptions, setSubscriptions] = useState([]);\r\n    const [isGroupInfoLoading, setGroupInfoLoading] = useState(false);\r\n    const [groupInfo, setGroupInfo] = useState({\r\n        description: '',\r\n        avatar: '',\r\n        name: '',\r\n        unsubscribeColor: '',\r\n        subscribeColor: ''\r\n    });\r\n\r\n    const loadGroupInfo = async () => {\r\n        if (isGroupInfoLoading) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({ method: 'vkapp.load_info', group_id: vk_group_id, user_vk_id }));\r\n            const { subscriptions, ...data } = await res.json();\r\n\r\n            if (data.status !== 'ok') {\r\n                throw new Error('Не удалось загрузить данные');\r\n            }\r\n\r\n            setGroupInfoLoading(true);\r\n\r\n            setGroupInfo({\r\n                ...groupInfo,\r\n                description: data.description,\r\n                avatar: data.avatar,\r\n                name: data.name,\r\n                subscribeColor: data.subscribe_color,\r\n                unsubscribeColor: data.unsubscribe_color\r\n            });\r\n\r\n            setSubscriptions(subscriptions);\r\n        } catch (error) {\r\n            setGroupInfoLoading(false);\r\n        }\r\n    };\r\n\r\n    const source = subscriptionId ? 2 : 1;\r\n\r\n    const item = subscriptions.find(subscription => subscription.id === subscriptionId);\r\n\r\n    const pageDescription = item\r\n        ? (item.description || '')\r\n        : groupInfo.description || '';\r\n\r\n    const subscribe = async (item) => {\r\n\r\n        showSpinner();\r\n\r\n        try {\r\n            const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({\r\n                user_vk_id,\r\n                method: 'vkapp.subscribe_user',\r\n                subscribe_id: item.id,\r\n                group_id: vk_group_id,\r\n            }));\r\n\r\n            const { status, ...data } = await res.json();\r\n\r\n            if (status !== 'ok') {\r\n                throw new Error(data.text || 'Что-то пошло не так. Не удалось подписаться');\r\n            }\r\n\r\n            const s = subscriptions.map(item => item);\r\n            const i = s.find(subscription => subscription.id === item.id);\r\n\r\n            i.isSubscribed = true;\r\n            i.count = item.count + 1\r\n\r\n            setSubscriptions(s);\r\n            openSubscribeModal();\r\n        } catch (error) {\r\n            alert(error.toString());\r\n        }\r\n    };\r\n\r\n    const unsubscribeItem = async (item) => {\r\n        try {\r\n            const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({\r\n                user_vk_id,\r\n                method: 'vkapp.unsubscribe_user',\r\n                subscribe_id: item.id,\r\n                group_id: vk_group_id,\r\n            }));\r\n\r\n            const { status, ...data } = await res.json();\r\n\r\n            if (status !== 'ok') {\r\n                throw new Error(data.text || 'Что-то пошло не так. Не удалось отписаться');\r\n            }\r\n\r\n            item.isSubscribed = false;\r\n            item.count = item.count - 1\r\n\r\n            return item;\r\n\r\n        } catch (error) {\r\n            alert(error.toString());\r\n        }\r\n    }\r\n\r\n    const onUnsubscribe = async (item) => {\r\n\r\n        showSpinner();\r\n\r\n        var s = subscriptions.map(item => item);\r\n        var i = s.find(subscription => subscription.id === item.id);\r\n\r\n        await unsubscribeItem(i);\r\n\r\n        setSubscriptions(s);\r\n        openUnsubscribeModal();\r\n    };\r\n\r\n    const unsubscribeAll = async () => {\r\n\r\n        showSpinner();\r\n        try {\r\n            const res = await fetch('https://smm-n.targethunter.dev/ajax?' + buildQuery({\r\n                user_vk_id,\r\n                method: 'vkapp.unsubscribe_all',\r\n                group_id: vk_group_id,\r\n            }));\r\n\r\n\r\n            const data = await res.json();\r\n\r\n            if (data.status !== 'ok') {\r\n                throw new Error(data.text || 'Что-то пошло не так. Не удалось отписаться');\r\n            }\r\n\r\n            showSpinner();\r\n\r\n            const s = subscriptions.map(item => item);\r\n\r\n            for(const subscription of s) {\r\n                if (!subscription.isSubscribed) {\r\n                    continue;\r\n                }\r\n\r\n                await unsubscribeItem(subscription);\r\n            }\r\n\r\n            setSubscriptions(s);\r\n            openUnsubscribeModal();\r\n        } catch (error) {\r\n            alert(error.toString());\r\n        }\r\n    };\r\n\r\n    const [popout, setPopout] = useState(null);\r\n\r\n    const openSubscribeModal = () => {\r\n        setPopout(<Alert\r\n            actions={[{\r\n                title: 'закрыть',\r\n                autoclose: true,\r\n                style: 'cancel'\r\n            }]}\r\n            onClose={() => setPopout(null)}\r\n        >\r\n            <h2>Вы успешно подписались на рссылку.</h2>\r\n            <p>Рассылка скоро придёт Вам в личные сообщения.</p>\r\n            <Div>\r\n                <Button onClick={() => window.top.location.href = 'https://vk.com/im?sel=-' + vk_group_id} size=\"l\" stretched>Перейти к сообщениям</Button>\r\n            </Div>\r\n        </Alert>);\r\n    }\r\n\r\n    const openUnsubscribeModal = () => {\r\n        setPopout(<Alert\r\n            actions={[{\r\n                title: 'закрыть',\r\n                autoclose: true,\r\n                style: 'cancel'\r\n            }]}\r\n            onClose={() => setPopout(null)}\r\n        >\r\n            <h2>Вы отписаны.</h2>\r\n            <p>Рассылка Вам больше не будет приходить.</p>\r\n        </Alert>);\r\n    }\r\n\r\n    const showSpinner = () => {\r\n        setPopout(<ScreenSpinner size=\"large\" />);\r\n    }\r\n\r\n    useEffect(() => {\r\n        loadGroupInfo();\r\n    });\r\n\r\n    return (\r\n        <View popout={popout} activePanel=\"main\">\r\n            <Panel id=\"main\">\r\n                <PanelHeader>Рассылка сообщений</PanelHeader>\r\n                <div style={{ textAlign: 'center' }}>\r\n                    {item && item.banner\r\n                        && <img src=\"https://scx1.b-cdn.net/csz/news/800/2019/1-nature.jpg\" alt=\"Баннер\" style={{ maxWidth: '100%' }}></img>}\r\n                </div>\r\n\r\n                <div style={{ padding: '15px' }}>\r\n\r\n                    {(!item || !item.banner)\r\n                        && <p className=\"page-title\">\r\n                            <img src={groupInfo.avatar} alt=\"Аватарка паблика\" style={{ borderRadius: '50%', marginRight: '16px' }} />\r\n                            {groupInfo.name}</p>\r\n                    }\r\n\r\n                    <p className=\"page-description\">{pageDescription}</p>\r\n\r\n\r\n                    {subscriptions.filter(subscription => (!subscriptionId || subscription.id === subscriptionId)).map(subscription =>\r\n                        <SubscriptionItem\r\n                            item={subscription}\r\n                            source={source}\r\n                            subscribe={subscribe}\r\n                            unsubscribe={onUnsubscribe}\r\n                            subscribeColor={groupInfo.subscribeColor}\r\n                            unsubscribeColor={groupInfo.unsubscribeColor}\r\n                            isSubscriptionPage={!!item}\r\n                            key={subscription.id} />\r\n                    )}\r\n\r\n                    {subscriptions.filter(item => item.isSubscribed).length > 0 && <div style={{ textAlign: 'center' }}>\r\n                        <button\r\n                            onClick={unsubscribeAll}\r\n                            data-source=\"1\" style={{ backgroundColor: groupInfo.unsubscribeColor }}\r\n                            className=\"subscriptions-group-button unsubscribe-button unsubscribe-all\"\r\n                            id=\"unsubscribe-all\">Отписаться от всех рассылок</button>\r\n                    </div>}\r\n                </div>\r\n            </Panel>\r\n        </View >\r\n    );\r\n}\r\n\r\nexport default App;\r\n\r\n","import 'core-js/features/map';\r\nimport 'core-js/features/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport connect from '@vkontakte/vk-connect';\r\nimport App from './App';\r\n// import registerServiceWorker from './sw';\r\n\r\n// Init VK  Mini App\r\nconnect.send('VKWebAppInit');\r\n\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\r\n// registerServiceWorker();\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n"],"sourceRoot":""}